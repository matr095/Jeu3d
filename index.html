<html>
<head><title>Luis Tieh 6 par MatR - Work in Progress</title></head>
<body></body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r99/three.min.js"></script>
	<script>
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 10000 );

		var renderer = new THREE.WebGLRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );

		camera.position.y = 15;
		camera.position.z = -20
		camera.rotation.y -= Math.PI/2

		var map = [
			[40,-1,0,200,1,200, 'textures/sol.png'],
			[0,0,0,5000,5000,5000, 'textures/ciel.png'],
			[8,1,0,0.5,4,8, 'textures/voie.png'],
			[10,-0.5,0,2,1,150, 'textures/voie.png'],
			[14,-0.5,0,2,1,150, 'textures/voie.png'],
			[16,1,0,0.5,4,8, 'textures/voie.png'],
			[30,4,0,10,10,30, 'textures/maison.png'],
			[50,4,-10,30,10,10, 'textures/maison.png'],
			[50,4,-30,50,10,10, 'textures/maison.png'],
			[-1,6,-20,10,12,100, 'textures/maison.png'],
			[-1,4,120,10,12,100, 'textures/maison.png'],
			[50,4,80,50,10,10, 'textures/maison.png'],
			[80,7,0,3,1,200, 'textures/voie.png'],
			[84,7,0,3,1,200, 'textures/voie.png'],
			[-80,-1.5,0,30,1,200, 'textures/plage.png'],
			[120,0,0,10,2,200, 'textures/terre.png'],
			[125,1,0,10,2,200, 'textures/terre.png'],
			[130,2,0,10,2,200, 'textures/terre.png'],
			[135,3,0,10,2,200, 'textures/terre.png'],
			[140,4,0,10,2,200, 'textures/terre.png'],
			[145,5,10,2,200, 'textures/terre.png'],
			[150,6,0,10,2,200, 'textures/terre.png'],
		];
		var objects = [];

		map.forEach(function(object, index) {
			var texture = new THREE.TextureLoader().load( object[6] );
			var geometry = new THREE.BoxGeometry();
			var material = new THREE.MeshBasicMaterial( { map: texture, side : THREE.DoubleSide } );
			window["object"+index] = new THREE.Mesh( geometry, material );
			window["object"+index].position.set(object[0],object[1],object[2]);
			window["object"+index].scale.set(object[3],object[4],object[5]);
			scene.add(window["object"+index]);
			objects.push(window["object"+index]);
		})


		document.addEventListener('keydown', function(e) {
			if(e.key == "ArrowLeft") {
				camera.rotation.y += Math.PI/16
			}
			if(e.key == "ArrowRight") {
				camera.rotation.y -= Math.PI/16
			}
			if(e.key == "ArrowUp") {
				camera.translateZ(-0.1);
				gravity = 2
			}
			if(e.key == " ") {
				camera.position.y += 2
				gravity = 2
			}
		});

		var gravity = 0

		var animate = function () {
			requestAnimationFrame( animate );

			//PREMIERE COLLISION PAR LE HAUT POUR STOPPER GRAVITE
			for(var index=0;index<objects.length;index++) {
				var object = objects[index];
				//si on touche par le haut de l'objet
				if(
					(camera.position.y <= object.position.y + object.scale.y/2 + 1)
					&&
					(camera.position.y >= object.position.y + object.scale.y/2 + 0)
					&&
					(camera.position.x <= object.position.x + object.scale.x/2 + 0.5)
					&&
					(camera.position.x >= object.position.x - object.scale.x/2 - 0.5)
					&&
					(camera.position.z <= object.position.z + object.scale.z/2 + 0.5)
					&&
					(camera.position.z >= object.position.z - object.scale.z/2 - 0.5)
				) {
					gravity = 1;
				} else {
					if(gravity == 0)
						gravity = 2;
				}
			}

			if(gravity == 2) {
				camera.position.y -= 0.1;
			}

			//DEUXIEME COLLISION PAR LES COTES POUR ARRETER DEPLACEMENT
			for(var index=0;index<objects.length;index++) {
				var object = objects[index];
				if(
					(
						(camera.position.y <= object.position.y + object.scale.y/2)
						&&
						(camera.position.y >= object.position.y - object.scale.y/2)
					)
					&&
					(
						(
							(camera.position.x <= object.position.x + object.scale.x/2 + 0.5)
							&&
							(camera.position.x >= object.position.x + object.scale.x/2)
							&&
							(camera.position.z <= object.position.z + object.scale.z/2)
							&&
							(camera.position.z >= object.position.z - object.scale.z/2)
						)
						||
						(
							(camera.position.x >= object.position.x - object.scale.x/2 - 0.5)
							&&
							(camera.position.x <= object.position.x - object.scale.x/2)
							&&
							(camera.position.z <= object.position.z + object.scale.z/2)
							&&
							(camera.position.z >= object.position.z - object.scale.z/2)
						)
						||
						(
							(camera.position.z <= object.position.z + object.scale.z/2 + 0.5)
							&&
							(camera.position.z >= object.position.z + object.scale.z/2)
							&&
							(camera.position.x <= object.position.x + object.scale.x/2)
							&&
							(camera.position.x >= object.position.x - object.scale.x/2)
						)
						||
						(
							(camera.position.z >= object.position.z - object.scale.z/2 - 0.5)
							&&
							(camera.position.z <= object.position.z - object.scale.z/2)
							&&
							(camera.position.x <= object.position.x + object.scale.x/2)
							&&
							(camera.position.x >= object.position.x - object.scale.x/2)
						)
					)
				) {
					camera.translateZ(0.1);
				}
			}




			renderer.render( scene, camera );


		};

		animate();
	</script>
</html>